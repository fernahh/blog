<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="utf-8" />
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"></meta>
    <link rel="canonical" href="https://fernahh.com.br/web-workers-ftw/">

    <title>Web Workers FTW! | fernahh</title>

    <link rel="apple-touch-icon" href="/apple-touch-icon.jpg" />
    <link rel="icon" href="/favicon-cd3c3b6e.png" />

    <meta name="description" content="Como todos sabemos, paralelismo sempre foi um problema quando estamos falando de JavaScript. Porém, com a Web Workers API a situação muda. Vamos conhecer essa oitava maravilha do mundo!"></meta>
    <meta property="og:type" content="article"></meta>
    <meta property="og:title" content="Web Workers FTW! | fernahh."></meta>
    <meta property="og:site_name" content="fernahh. desenvolvedor e de buenas na web."></meta>
    <meta property="og:description" content="Como todos sabemos, paralelismo sempre foi um problema quando estamos falando de JavaScript. Porém, com a Web Workers API a situação muda. Vamos conhecer essa oitava maravilha do mundo!"></meta>

    <meta name="twitter:card  " content="summary"></meta>
    <meta name="twitter:site" content="fernahh."></meta>
    <meta name="twitter:creator" content="@fernahh"></meta>
    <meta name="twitter:url" content="https://fernahh.com.br/web-workers-ftw/"></meta>
    <meta name="twitter:title" content="Web Workers FTW! | fernahh."></meta>
    <meta name="twiter:description" content="Como todos sabemos, paralelismo sempre foi um problema quando estamos falando de JavaScript. Porém, com a Web Workers API a situação muda. Vamos conhecer essa oitava maravilha do mundo!"></meta>

    <link href='https://fonts.googleapis.com/css?family=Open+Sans:100,400,700' rel='stylesheet' type='text/css' />
    <link href="../assets/stylesheets/application-9f190f64.css" rel="stylesheet" type="text/css" />
  </head>

  <body class="web-workers-ftw web-workers-ftw_index">
    <div class="Container">
      <div class="Header_Navigation">
  <header class="Header">
    <h1>
<a title="fernahh.com.br" href="/">        <strong>fernahh</strong>.
</a>    </h1>
  </header>
</div>

        <article class="Article" role="article">
    <header>
    <time class="Post_Index__Date" datetime="2013/07/22">
      Publicado em: 22/07/2013</time>
      <h1 class="Article__Title">Web Workers FTW!</h1>
    </header>
    <section>
      <p><img alt="Web Workers FTW!" src="http://andafter.org/media/images/posts/thumbs/770x300/webworkers_770x300.jpg" /></p>

<p>Imagine a seguinte situação: uma página onde você carrega um plugin de slideshow, autenticação com Facebook e load de dados através de JavaScript, entre outra carralhada de arquivos. Comum, certo? Agora me diga, quantas vezes você teve problema com botões que não respondiam aos seus eventos? Nenhum? Ok. Quantas vezes essa aplicação gerou um crash no navegador?</p>

<p>Se você já enfrentou os problemas que citei acima, keep calm, você não está 100% errado. Cada vez mais nós, desenvolvedores, estamos fazendo aplicações que exigem trabalho pesado usando JavaScript. Pensando nisso, eis que surge a oitava maravilha do mundo, <a href="http://www.w3.org/TR/workers/">Web Workers API</a>.</p>

<h2>O que é paralelismo</h2>

<p>Vamos à uma rápida explicação. Caso você já esteja ligado no assunto, pule para o próximo tópico.</p>

<p>Paralelismo, ou melhor, <strong>Programação Paralela</strong>, é a forma com que conseguimos fazer um algoritmo executar diversas tarefas usando mais de um processo, thread, ou no nosso caso, <strong>workers</strong>! Tudo isso com o intuito de ganhar mais performance. Não entendeu? Beleza. Uma imagem fala mais do que mil palavras:</p>

<p><img alt="Representação de paralelismo" src="http://andafter.org/media/users/1740/web-workers-explained.jpg" /></p>

<p>Se interessou por Programação Paralela? Ainda não entendeu? Aí vai uma boa referência: <a href="https://computing.llnl.gov/tutorials/parallel_comp/">https://computing.llnl.gov/tutorials/parallel_comp/</a>.</p>

<h2>Como funciona</h2>

<p>Atualmente é possível executar eventos de forma assíncrona usando <code>setTimeout()</code>, <code>setInterval()</code>, <code>XMLHttpRequest</code> entre outros hacks (ok, chutem-me). Porém, isso não quer dizer que é paralelo, sendo que os eventos são executados quando o script é renderizado.</p>

<p>Web Workers trabalham de forma diferente. E melhor. Como JavaScript não é uma linguagem que usa multi-threads, os Workers de certa forma &ldquo;estendem-a&rdquo; em alguns casos, possibilitando executar tarefas com mais uma thread. A API define que processos serão executados de forma assíncrona em outro contexto, por scripts que se comunicam através de mensagens que são passadas pelo método <code>postMessage()</code>.</p>

<h2>Mãos à obra</h2>

<p>Para não sair da tradição (risos), vamos à um &ldquo;Hello World&rdquo;.</p>

<p>Como Web Workers executam paralelamente de forma isolada ao processo principal, vamos criar um novo arquivo que receberá a &ldquo;ordem&rdquo; desse processo e executará sua função. No nosso exemplo, chamei de <strong>worker.js</strong> e possui a função abaixo:</p>
<pre class="highlight javascript"><code>  <span class="c1">// recebe a mensagem do processo principal</span>
  <span class="nx">onmessage</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">message</span> <span class="o">=</span> <span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">message</span> <span class="o">+</span> <span class="s1">' no And After!'</span><span class="p">;</span>
    <span class="nx">postMessage</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span>
  <span class="p">}</span>
</code></pre>

<p>Feito isso, vamos criá-lo no processo principal:</p>
<pre class="highlight javascript"><code>  <span class="kd">var</span> <span class="nx">myWorker</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Worker</span><span class="p">(</span><span class="s1">'worker.js'</span><span class="p">);</span>
</code></pre>

<p>Para passar nossa informação, precisamos do método <code>postMessage()</code>:</p>
<pre class="highlight javascript"><code>  <span class="kd">var</span> <span class="nx">message</span> <span class="o">=</span> <span class="s1">'Web Workers'</span><span class="p">;</span>
  <span class="nx">myWorker</span><span class="p">.</span><span class="nx">postMessage</span><span class="p">(</span><span class="nx">message</span><span class="p">);</span>
</code></pre>

<p>E para finalizar, precisamos receber a mensagem do Worker:</p>
<pre class="highlight javascript"><code>  <span class="c1">// Recebe a mensagem do worker</span>
  <span class="nx">myWorker</span><span class="p">.</span><span class="nx">onmessage</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">alert</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
  <span class="p">};</span>
</code></pre>

<p>Se não quiser fazer na mão, é só baixar o <a href="http://www.euescuto.com.br/worker-and-after.zip">exemplo aqui</a>. Ou, você pode ver uns exemplos <a href="http://www.html5rocks.com/en/tutorials/workers/basics/#toc-gettingstarted">nesse link</a>.</p>

<p>PS: isso não vai rodar localmente por restrições dos browsers modernos. Então, para aproveitar a trégua, aproveito para explicar que, como workers são arquivos externos, não será possível carregá-lo através de scripts que começaram com http:. Para ver esse exemplo funcionando, clique aqui.</p>

<p>PS: isso não vai rodar localmente por restrições dos browsers modernos. Então, para aproveitar a trégua, aproveito para explicar que, como workers são arquivos externos, não será possível carregá-lo através de scripts que começaram com http:. Para ver esse exemplo funcionando, <a href="http://www.euescuto.com.br/worker-and-after/worker-andafter.html">clique aqui</a>.</p>

<p>Leia mais sobre segurança em <a href="http://www.html5rocks.com/en/tutorials/workers/basics/#toc-security">http://www.html5rocks.com/en/tutorials/workers/basics/#toc-security</a>.</p>

<p>Talvez você esteja pensando <em>&ldquo;porrah, pra quê tanta enrolação para escrever uma mensagem na tela?&rdquo;</em>. Calma lá. Web Workers servem para auxiliar em tarefas porradas, como renderização 3D, cálculos que exigem mais desempenho, etc.</p>

<p><strong>Importante: caso você não tenha percebido, o nosso exemplo não acessa o DOM diretamente. Web Workers não tem acesso ao DOM!</strong></p>

<p>Além do DOM, Web Workers não tem acesso aos objetos <code>window</code>, <code>document</code> e <code>parent</code>. Mas calma, apesar disso, Web Workers tem acesso aos seguintes recursos do JavaScript:</p>

<ul>
<li><code>navigator</code> com quatro propriedades: <code>appName</code>, <code>appVersion</code>, <code>userAgent</code> e <code>platform</code>.</li>
<li><code>location</code> (somente leitura)</li>
<li><code>self</code>, que aponta para o objeto worker global</li>
<li><code>importScripts()</code> para fazer load de um JavaScript externo</li>
<li>todos os objetos do JavaScript, como <code>Object</code>, <code>Array</code>, <code>Math</code>, etc</li>
<li><code>XMLHttpRequest</code></li>
<li><code>setTimeout()/clearTimeout()</code> e <code>setInterval()/clearInterval()</code></li>
<li>há também um método <code>close()</code> usado parar um Worker</li>
</ul>

<h2>Conclusão</h2>

<p>Web Workers é algo novo, logo, a API pode mudar a qualquer hora, e pra melhor. Acredito que eles irão além do browser. Isso é só o começo, e já é demais!</p>

<p><strong>Referências:</strong></p>

<ul>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/Guide/Performance/Using_web_workers">Using Web Workers</a>, no Mozilla Developer Network</li>
<li><a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/workers.html">Especificação do Web Workers</a>, no WHATWG community</li>
<li><a href="http://www.html5rocks.com/en/tutorials/workers/basics/">The Basics of Web Workers</a>, no HTML5 Rocks</li>
<li><a href="https://dev.opera.com/articles/web-workers-rise-up/">Web Workers rise up!</a>, no Dev Opera.</li>
</ul>

<p><a href="http://odesenvolvedor.andafter.org/publicacoes/web-workers-ftw.html">Publicado originalmente no blog O Desenvolvedor.</a></p>

    </section>
  </article>

      <footer class="Footer">
  <div>
    <nav class="Navigation">
  <ul class="Navigation__List">
    <li class="Navigation__List__Item">
<a class="Navigation__List__Item__Link" title="Link para o Twitter" href="https://twitter.com/fernahh">        Twitter
</a>    </li>
    <li class="Navigation__List__Item">
<a class="Navigation__List__Item__Link" title="Projetos no Github" href="https://github.com/fernahh">        Github
</a>    </li>
    <li class="Navigation__List__Item">
<a class="Navigation__List__Item__Link" title="Perfil no LinkedIn" href="https://www.linkedin.com/in/fernahh">        LinkedIn
</a>    </li>
  </ul>
</nav>

  </div>
</footer>

    </div>

    <script src="../assets/javascripts/application-56d518d4.js" type="text/javascript"></script>
  </body>
</html>
